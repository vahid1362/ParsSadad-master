@using Kendo.Mvc.UI
@model QtasHelpDesk.ViewModels.Media.GalleryViewModel

<input asp-for="Id" class="form-control" />
<div class="row">
    <div class="form-horizontal">
        <div class="row">
            <div class="form-group">
                <label asp-for="Title" class="control-label col-md-2"></label>
                <div class="col-md-7">
                    <input asp-for="Title" class="form-control" />
                </div>
            </div>
            <div class="form-group">
                <label asp-for="Content" class="control-label col-md-2"></label>
                <div class="col-md-7">
                    <input asp-for="Content" class="form-control" />
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2"></div>
            <div class="col-md-5">
                <input type="hidden" asp-for="PictureId"/>
                @(Html.Kendo().Upload()
                      .Name("files")
                      .Async(a => a
                          .Save("Save", "Gallery", new {pictureId = @Model.PictureId})
                          .Remove("Remove", "Gallery")
                          .AutoUpload(true)
                      )
                      .Events(events => events

                          .Remove("onRemove")
                          .Success("onSuccess")


                      )
                      .Multiple(false)
                      .Validation(validation =>
                      {
                          validation.AllowedExtensions(new string[] {".jpg", ".jpeg", ".png", ".bmp", ".gif"});
                          validation.MinFileSize(500).MaxFileSize(1240000);
                      }))
            </div>
            <div class="col-md-2 text-left">
                
                        <div id="images"></div>
                 
            </div>
        </div>
    </div>
</div>

<script>

    var pictureId='';
    @*$(function () {

        $('#addContentPicture').click(function () {

            $("#addContentPicture").attr('disabled', true);

            var displayOrder = $("#@Html.IdFor(model=>model.AddContentPictureModel.DisplayOrder)").val();
            var contentId = $("#@Html.IdFor(model=>model.Id)").val();

            var postData = {
                PictureId: pictureId,
                DisplayOrder: displayOrder,
                ContentId: contentId
            };


            $.ajax({
                type: "POST",
                url:"@Url.Action("AddContentPicture", "Content")",
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify(postData),
                success: function (response) {
                    $("#addContentPicture").attr('disabled', false);
                    alert("ok");
                },
                failure: function (response) {
                    alert("error");
                }
            });



        });

    });*@

    function onSuccess(e) {
        if (e.operation == "upload") {


            pictureId = e.response.pictureId;

            $("#@Html.IdFor(model=>model.PictureId)").val(pictureId);

            for (var i = 0; i < e.files.length; i++) {
                var file = e.files[i].rawFile;

                if (file) {
                    var reader = new FileReader();

                    reader.onloadend = function () {
                        $("<div ><img class='imageUpload' src=" + this.result + " /></div>").appendTo($("#images"));
                    };

                    reader.readAsDataURL(file);



                }
            }
        }
    }

    function onRemove(e) {

        $("#images").children().remove();
    }




</script>
<style>

    .imageUpload {
        width: 150px;
        height: 115px;
    }
</style>